process HLT  = 
{
   service = DQMStore{}	
	

   include "FastSimulation/Configuration/data/RandomServiceInitialization.cff"
   include "FastSimulation/Configuration/data/CommonInputs.cff"
   include "FastSimulation/Configuration/data/FamosSequences.cff"

   # L1 Emulator and HLT Setup
   include "FastSimulation/HighLevelTrigger/data/common/HLTSetup.cff"


   // If you want to turn on/off pile-up
   replace famosPileUp.PileUpSimulator.averageNumber = 0.0

    // Get frontier conditions
    // Values for globaltag are "STARTUP::All", "1PB::All", "10PB::All", "IDEAL::All"
    replace GlobalTag.globaltag = "STARTUP::All"

    // Apply ECAL miscalibration (ideal calibration though) and HCAL miscalibration
    replace caloRecHits.RecHitsFactory.doMiscalib=true

    // Apply Tracker misalignment (ideal alignment though)
    replace famosSimHits.ApplyAlignment = true
    replace misalignedTrackerGeometry.applyAlignment = true

    // Apply HCAL miscalibration (not ideal in that case)
    replace caloRecHits.RecHitsFactory.HCAL.Refactor = 1.0
    replace caloRecHits.RecHitsFactory.HCAL.Refactor_mean = 1.00


   // prescale factors at L1 : useful for testing all L1 paths
   include "Configuration/StandardSequences/data/L1TriggerDefaultMenu.cff"

  
   service = Timing { }

    untracked PSet maxEvents = {untracked int32 input = 5000}

    # Gen paths
    ###################SOURCE#########################
    include "Configuration/Generator/data/ZTT.cfi"
    ##########################END OF SOURCE#############################

    # Simulation
    include "PhysicsTools/HepMCCandAlgos/data/genEventWeight.cfi"
    include "PhysicsTools/HepMCCandAlgos/data/genEventScale.cfi"
    sequence simulation = { 
    simulationWithFamos &  genEventScale & genEventWeight }

    # Reconstruction of all events, including those rejected at L1/HLT
    sequence HLTEndSequence = { dummyModule }

    # HLT paths
    include "FastSimulation/Configuration/test/HLT.cff"
	
    path reconstruction = { 
	reconstructionWithFamos // Reconstruction sequence
    }



include "HLTriggerOffline/Tau/data/HLTTauRefInfo.cfi"
include "HLTriggerOffline/Tau/data/HLTTauRefCombiner.cfi"


//-------------------------MC Based Validation -------------------------------//




//General
module HLTTauValidationMC = HLTTauValidation {
untracked	InputTag triggerEventObject = hltTriggerSummaryRAW
untracked	InputTag refTauCollection      = TauRefInfoProducer:MCTaus
untracked	InputTag refLeptonCollection      = NOTHING
untracked	string   TriggerTag         = "HLTValRefToMC" 
untracked	bool     DoReferenceAnalysis= true
untracked	uint32    NTriggeredTaus     = 2	
untracked	uint32    NTriggeredLeptons  = 0	
untracked	InputTag   L1SeedFilter       = hltDoubleTauL1SeedFilter::HLT
untracked	InputTag   L2EcalIsolFilter   = hltFilterDoubleTauEcalIsolation::HLT
untracked	InputTag   L25PixelIsolFilter = hltFilterL25PixelTau::HLT
untracked	InputTag   L3SiliconIsolFilter= DUMMY
untracked	InputTag   ElectronFilter     = DUMMY
untracked	InputTag   MuonFilter         = DUMMY
untracked	double   MatchDeltaRL1      = 0.5
untracked	double   MatchDeltaRHLT     = 0.3
untracked	string   OutputFileName     =""	    
untracked	string   LogFileName     ="HLTValRefToMC.log"	    

}

//L2 Validation

module L2TauValidationMC = L2TauValidation {
InputTag L2InfoAssociationInput=  hltL2DoubleTauIsolationProducer:L2TauIsolationInfoAssociator
InputTag MatchedCollection     =  TauRefInfoProducer:MCTaus
InputTag MET                   =  hltMet
int32	 MatchLevel            =  1
double   MatchDeltaRMC         =  0.15
double   MatchDeltaRL1         =  0.5
string   TriggerTag            =  "L2ValidationRefToMC"
string   OutputFileName        =  ""
vdouble  Cuts                  = {5.,1000.,-1,1000,1000,1000,1000}
InputTag L1TauTrigger          = hltDoubleTauL1SeedFilter

}

//L25Validation

module L25TauValidationMC = L25TauValidation {
   
   InputTag JetTagProd = hltConeIsolationL25PixelTauIsolated
   InputTag JetMCTagProd = TauRefInfoProducer:MCTaus				   
   InputTag l2CaloJets  = hltL2DoubleTauIsolationSelector:Isolated        
   										  									   	   
   //Cuts for effciency plots
   double SignalCone = 0.15							   
   double MatchingCone = 0.1						   	   
   double IsolationCone = 0.5 						   	   
   double MinimumTransverseMomentumLeadingTrack = 3.			   	   
   double MinimumTransverseMomentumInIsolationRing = 1. 		   	   
   int32  MaximumNumberOfTracksIsolationRing = 0			   	   
   										   
   bool Signal = true								   
   double MCMatching = 0.30 
   string   TriggerTag            =  "L25ValidationRefToMC"
   string OutputFileName = ""						   
}




//-------------------------PF Based Validation -------------------------------//

//General
module HLTTauValidationPF = HLTTauValidation {
untracked	InputTag triggerEventObject = hltTriggerSummaryRAW
untracked	InputTag refTauCollection      = TauRefCombiner:GoodTaus
untracked	InputTag refLeptonCollection      = NOTHING
untracked	string   TriggerTag         = "HLTValRefToPF" 
untracked	bool     DoReferenceAnalysis= true
untracked	uint32    NTriggeredTaus     = 2	
untracked	uint32    NTriggeredLeptons  = 0	
untracked	InputTag   L1SeedFilter       = hltDoubleTauL1SeedFilter::HLT
untracked	InputTag   L2EcalIsolFilter   = hltFilterDoubleTauEcalIsolation::HLT
untracked	InputTag   L25PixelIsolFilter = hltFilterL25PixelTau::HLT
untracked	InputTag   L3SiliconIsolFilter= DUMMY
untracked	InputTag   ElectronFilter     = DUMMY
untracked	InputTag   MuonFilter         = DUMMY
untracked	double   MatchDeltaRL1      = 0.5
untracked	double   MatchDeltaRHLT     = 0.3
untracked	string   OutputFileName     =""	    
untracked	string   LogFileName     ="HLTValRefToPF.log"	    

}

//L2 Validation

module L2TauValidationPF = L2TauValidation {
InputTag L2InfoAssociationInput=  hltL2DoubleTauIsolationProducer:L2TauIsolationInfoAssociator
InputTag MatchedCollection     =  TauRefCombiner:GoodTaus
InputTag MET                   =  hltMet
int32	 MatchLevel            =  1
double   MatchDeltaRMC         =  0.15
double   MatchDeltaRL1         =  0.5
string   TriggerTag            =  "L2ValidationRefToPF"
string   OutputFileName        =  ""
vdouble  Cuts                  = {5.,1000.,-1,1000,1000,1000,1000}
InputTag L1TauTrigger          = hltDoubleTauL1SeedFilter

}

//L25Validation

module L25TauValidationPF = L25TauValidation {
   
   InputTag JetTagProd = hltConeIsolationL25PixelTauIsolated
   InputTag JetMCTagProd = TauRefCombiner:GoodTaus		   
   InputTag l2CaloJets  = hltL2DoubleTauIsolationSelector:Isolated        
   										  									   	   
   //Cuts for effciency plots
   double SignalCone = 0.15							   
   double MatchingCone = 0.1						   	   
   double IsolationCone = 0.5 						   	   
   double MinimumTransverseMomentumLeadingTrack = 3.			   	   
   double MinimumTransverseMomentumInIsolationRing = 1. 		   	   
   int32  MaximumNumberOfTracksIsolationRing = 0			   	   
   										   
   bool Signal = true								   
   double MCMatching = 0.30 
     							   
   string   TriggerTag            =  "L25ValidationRefToPF"
   string OutputFileName = "HLTTauVal210_pre5.root"						   
}


path MCVal = {TauRefInfoProducer,HLTTauValidationMC&L2TauValidationMC&L25TauValidationMC}
path PFVal = {TauRefCombiner,HLTTauValidationPF&L2TauValidationPF&L25TauValidationPF}

}
